<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="it" xml:lang="it">
<head>
<!-- 2021-11-14 dom 21:57 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SDC - Lesson 03</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Alessandro Straziota" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" href="/appunti.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="/"> HOME </a>
</div><div id="content">
<h1 class="title">SDC - Lesson 03</h1>
<div id="table-of-contents">
<h2>Indice</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgfae49e5">1. Conenso</a></li>
<li><a href="#org47f6a5e">2. Transazioni e blocchi</a>
<ul>
<li><a href="#org8973469">2.1. Verifica dei blocchi - Merkle Tree</a></li>
</ul>
</li>
</ul>
</div>
</div>


<div id="outline-container-orgfae49e5" class="outline-2">
<h2 id="orgfae49e5"><span class="section-number-2">1</span> Conenso</h2>
<div class="outline-text-2" id="text-1">
<p>
Ricapitolando, abbiamo una popolazione di \(p_1,p_2,...,p_n\) individui con <b>uguale</b> conoscenza.
Ogni individuo \(p_i\) <i>contribuisce</i> al consenso con una opinione, il cui valore può essere con una qualsiasi quantità \(F_i\).
In un sistema <i>omogeneo</i> si ha che il valore è uguale per tutti, pari quindi a una frazione \(F_i = \frac{1}{n}\).<br />
</p>

<p>
Consideriamo un caso in cui abbiamo due pareri, il parere \(A \subseteq \left[ n \right]\) e il parere complementare \(B = \left[ n \right] \setminus A\).
In un sistema omogeneo, per far sì che l'opinione \(A\) prevelga sul complementare basta che
\[
  \sum_{i \in A} F_i > \frac{1}{2}
  \]
Ovvero che avevnga il cosidetto <i>50% + 1</i>.<br />
</p>

<p>
Nel sistema di consenso del bitcoin in realtà viene meno l'ipotesi di omogeneità.
Il contributo al consenso dell'individuo \(p_i\) è la quantità \(F_i = \frac{z_i}{n}\) tale che \(\sum_{i \in \left[ n \right] } z_i = n\).
Allo stesso modo, per far prevalere l'opinione \(A\) si necessita del <i>50% + 1</i>
\[
  \sum_{i \in A} F_i > \frac{n}{2}
  \]
</p>
</div>
</div>

<div id="outline-container-org47f6a5e" class="outline-2">
<h2 id="org47f6a5e"><span class="section-number-2">2</span> Transazioni e blocchi</h2>
<div class="outline-text-2" id="text-2">
<p>
Una <i>quantità di criptovaluta</i> è perfettamente identificata da una coppia di chiavi pubblica/privata<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>.
Come già detto nella <a href="./02.html">lezione 2</a> tutte le informazioni necessarie sono scritte in maniera immutabile in un <i>ledger</i>.<br />
</p>

<p>
È ben noto che nel sistema bitcoin, il ledger è implementato tramite una <i>blockchain</i>.
Una blockchain, come dice il nome stesso, è un database distribuito di tipo <i>append-only</i><sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup> formato da
una <i>catena di blocchi</i>.
</p>


<div class="figure">
<p><img src="../images/sdc-lesson03-img1.png" alt="sdc-lesson03-img1.png" width="90%" align="center" />
</p>
</div>

<p>
Dato che nella rete bitcoin ogni nodo possiede una copia locale della blockchain, si necessita che tutti i nodi <i>acconsentano</i> prima di
convalidare un blocco da appendere alla catena.
Ecco qua dove entra in gioco il consenso e la fiducia tra i peer.<br />
</p>

<p>
La <i>blockchain</i> non è temporizzata, ovvero i blocchi non seguono un ordine strettamente temporale.
Questo perché si necesiterebbe del <i>trust</i><sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup> verso un solo nodo che scandisce un clock di riferimento,
e questo come abbiamo visto non lo vogliamo.
Percò la blockchain è ordinata, ma secondo l'ordine di convalida dei blocchi.
Infatti a un peer interessa sapere la sua transazione è la 78-esima in ordine di arrivo, non che è avvenuta
alle 18:00 del 4 Agosto 2017.<br />
</p>

<p>
I ogni blocco sono presenti le informazioni riguardo un certo numero di transazioni.
Per verificare la correttezza di un nuovo blocco prima di dare un opinione su di esso, ogni nodo
deve potre verificare che <i>tutte</i> le transazioni al suo interno siano <i>consistenti</i>: ovvero che chi effettua
un pagamento, possegga effettivamente una certa quantità di moneta.
Per fare ciò si necessita di <i>risalire</i> all'indietro lungo i blocchi finchè non si verificano tutte le transazioni.
Perciò ogni blocco possiede un <i>riferimento</i> al suo blocco precedente.
</p>


<div class="figure">
<p><img src="../images/sdc-lesson03-img2.png" alt="sdc-lesson03-img2.png" width="90%" align="center" />
</p>
</div>

<p>
Per garantire l'<i>immutabilità</i> dei blocchi già convalidati si potrebbe usare l'<code>hash</code><sup><a id="fnr.4" class="footref" href="#fn.4">4</a></sup> dei blocchi come riferimento
al blocco precedente.
Ovvero, se un blocco <code>A</code> è il diretto successore del blocco <code>B</code>, allora in <code>A</code> è presente <code>hash(B)</code> come riferimento a <code>B</code>.
Questo garantisce se viene modificato il blocco <code>B</code>, e diventa il blocco <code>B'</code>, allora il riferimento <code>hash(B)</code> non è più valido,
perchè <code>hash(B)</code> è con altissima probabilità differente da <code>hash(B')</code>.
Periò, o bisogna modificare <code>A</code> scrivendo <code>hash(B')</code> al posto di <code>hash(B)</code>, e di conseguenza creando la necessità di modificare
tutti i successori di <code>A</code>, oppure più semplicemente la catena si spezza a <code>B</code>.
</p>


<div class="figure">
<p><img src="../images/sdc-lesson03-img3.png" alt="sdc-lesson03-img3.png" width="90%" align="center" />
</p>
</div>

<p>
Dato che calcolare l'output di una funzione <code>hash</code> è relativamente veloce, calcolare solo <code>hash(B)</code> per riferirsi a <code>B</code>
potrebbe risultare un'operazione troppo facile.
Per evitare che un nodo convalidi tantissimi blocchi in poco tempo, si necessita che la convalida di blocco sia un'operazione
relativamente impegnativa per tutti i nodi.<br />
</p>

<p>
Si potrebbe perciò chiedere di <i>trovare</i> un valore, chiamiato <b>nonce</b>, tale che <code>hash(nonce | B)</code><sup><a id="fnr.5" class="footref" href="#fn.5">5</a></sup> è un numero con determinate proprietà
non facili tra rispettare.
Per esempio, si potrebbe chiedere che <code>hash(nonce | B)</code> abbia i primi 5 bit pari a 0.
In generale si potrebbe chiedere che i primi \(k\) bit siano pari a 0, scegliendo un valore di \(k\) tale che l'<i>intera rete bitcoin</i> riesca a convalidare
un blocco mediamente ogni 10 minuti.<br />
Perché proprio \(k\) bit pari a 0? Perché maggiore è il numero di bit iniziali pari a 0, minore è la quantità di numeri con tale proprietà, perciò maggiore
è la difficolta necessaria per trovare un nonce valido.
Infatti, nella rete bitcoin, periodicamente la difficoltà di convalida di un blocco si <i>autoregola</i>, aumentando o diminuendo il numero di bit iniziali
pari a zero, a seconda della potenza di calcolo della rete al momento.<br />
</p>

<p>
Perciò, il processo di creazione di una transazione e convalida di un blocco si può riassumere nei seguenti passi:
</p>

<ol class="org-ol">
<li><b>Costruzione della transazione in locale</b>
Localmente costruisco la mia transazione come spiegato nella <a href="./02.html">lezione 2</a>.</li>
<li><b>Inserimento in un blocco</b>
Appendo la transazione in blocco, oppure chiedo di appenderla a un nodo che si occupa di convalidare i blocchi (noto come nodo <i>miner</i>).</li>
<li><b>Convalida del blocco</b>
Chi si occupa di convalida il blocco, controlla a ritroso nella sua copia locale della blockchain che tutte le transazioni siano consistenti.
Dopodiche inizia la ricerca del <i>nonce</i> che rispetta le proprietà richieste al momento.</li>
<li><b>Ricopensa</b>
Se si riesce a trovare il <i>nonce</i> giusto prima degli altri, il nodo in questione può prendere una ricompensa eseguendo una transazione verso se stesso,
attingendo al fondo di bitcoin presente nel blocco genesi.
Dopodichè può <i>firmare</i> il blocco con la sua chiave privata, e trasmetterlo agli altri.</li>
</ol>

<p>
Notare che, anche se un nodo trasmette un blocco malevolo, ovvero nel quale ci sono transazioni non consistenti o attingendo a premi maggiori del dovuto,
tale blocco verrà automaticamente <i>scartato</i> dagli altri, perdendo così di valore.
Infatti, chi riceve un nuovo blocco ne verifica a sua volta la correttezza.
In questa maniera, solo i blocchi non malevoli vengono considerati <i>veritieri</i>.<br />
</p>

<p>
Se si pensa bene, in questa maniera potrebbe capitare che più miner convalidino il proprio blocco nello stesso momento, creando così delle <i>diramazioni</i>
nella blockchain.
Ciò che fanno i nodi in realtà, e cercare di <i>unificarsi</i><sup><a id="fnr.6" class="footref" href="#fn.6">6</a></sup> con le diramazioni più lunghe delle quali sono a conoscenza.
In questa maniera, anche se si creano più diramazioni, vince quella più lunga, in quanto avendo più blocchi convalidati rispetto
agli altri significa che dietro ci è stato un lavoro <i>maggiore</i>.
Quindi vince sempre la catena nella quale c'è più <b>consenso</b> (in termini di potenza di calcolo investita).
</p>
</div>

<div id="outline-container-org8973469" class="outline-3">
<h3 id="org8973469"><span class="section-number-3">2.1</span> Verifica dei blocchi - Merkle Tree</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Per verificare che un blocco ricevuto sia consistente e non alterato, si ricorre ad una struttura data che consente di farlo in maniera efficiente: il <b>Merkle Tree</b>.
Anzichè calcolare tutti gli hash della blockchain, il Merkle Tree consente di calcolarne solamente un numero logaritmico.
Sostanzialmente, nei nodi foglia dell'albero sono presenti gli <i>hash</i> dei blocchi della blockchain.
Nei nodi foglia invece è presente l'<i>hash</i> dei nodi figli.
</p>


<div class="figure">
<p><img src="../images/sdc-lesson03-img4.png" alt="sdc-lesson03-img4.png" width="90%" align="center" />
</p>
<p><span class="figure-number">Figura 4: </span>Esempio di Merkle Tree</p>
</div>

<hr />
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Note a pi&egrave; di pagina: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
per brevità ci riferiremo con le sigle <code>pk</code> (<i>public-key</i>) e <code>sk</code> (<i>secret-key</i>).
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
ovvero in sola scrittura.
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
fiducia.
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara">
output di una funzione <i>hash crittografica</i>.
</p></div></div>

<div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5">5</a></sup> <div class="footpara"><p class="footpara">
la barra verticale <code>|</code> indica l'operazione di concatenazione.
</p></div></div>

<div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6">6</a></sup> <div class="footpara"><p class="footpara">
fare il <i>merge</i>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="date">Data: 2021-10-20 mer 00:00</p>
<p class="author">Autore: Alessandro Straziota</p>
<p class="email">Email: <a href="mailto:alessandrostr95@gmail.com">alessandrostr95@gmail.com</a></p>
<p class="date">Created: 2021-11-14 dom 21:57</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
